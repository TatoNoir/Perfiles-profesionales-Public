<div class="qa-page">
  <h2 class="title">Preguntas</h2>
  <ion-card>
    <ion-card-content>
      <ion-list class="qa-list">
        <ion-item *ngIf="loadingQuestions">
          <ion-label>
            <div style="text-align: center; padding: 2rem;">
              <ion-spinner></ion-spinner>
              <p>Cargando preguntas...</p>
            </div>
          </ion-label>
        </ion-item>
        <ion-item *ngIf="!loadingQuestions && questions.length === 0">
          <ion-label>
            <div style="text-align: center; padding: 2rem;">
              <p>No hay preguntas disponibles</p>
            </div>
          </ion-label>
        </ion-item>
        <ion-item lines="full" *ngFor="let q of questions" class="qa-item">
          <div class="left">
            <div class="question-header">
              <strong>{{ getUserDisplayName(q) }}</strong>
              <span class="date">{{ formatDate(q.created_at) | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="question"><strong>{{ q.question }}</strong></div>
            <div class="answer" [class.empty]="!hasAnswer(q)">{{ hasAnswer(q) ? q.answer : 'â€”' }}</div>
          </div>
          <div class="right">
            <ion-button size="small" fill="clear" (click)="onReply(q)">
              {{ hasAnswer(q) ? 'Modificar respuesta' : 'Responder' }}
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-modal [isOpen]="isReplyOpen" (didDismiss)="closeReply()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ selectedQuestion?.answer ? 'Modificar respuesta' : 'Responder pregunta' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button fill="clear" (click)="closeReply()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div *ngIf="selectedQuestion" style="margin-bottom: 1rem;">
          <p><strong>Pregunta:</strong></p>
          <p>{{ selectedQuestion.question }}</p>
        </div>
        <ion-textarea
          label="Respuesta"
          labelPlacement="stacked"
          placeholder="Escribe tu respuesta..."
          [(ngModel)]="replyText"
          [disabled]="savingAnswer"
          rows="6">
        </ion-textarea>
        <div style="margin-top: .75rem; display:flex; justify-content:flex-end; gap:.5rem;">
          <ion-button
            fill="outline"
            color="medium"
            (click)="closeReply()"
            [disabled]="savingAnswer">
            Cancelar
          </ion-button>
          <ion-button
            color="primary"
            (click)="submitReply()"
            [disabled]="savingAnswer || !replyText.trim()">
            <ion-spinner *ngIf="savingAnswer" name="crescent"></ion-spinner>
            <span *ngIf="!savingAnswer">{{ selectedQuestion?.answer ? 'Actualizar' : 'Enviar' }}</span>
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-toast
    [isOpen]="showToast"
    [message]="toastMessage"
    [color]="toastColor"
    [duration]="3000"
    (didDismiss)="showToast = false">
  </ion-toast>
</div>

