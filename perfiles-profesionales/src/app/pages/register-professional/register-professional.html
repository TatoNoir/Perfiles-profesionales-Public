<ion-content [fullscreen]="true">
  <!-- Header -->
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-button fill="clear" slot="start" (click)="closeModal()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
      <ion-title>Registro de Profesional</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="register-page">
    <!-- Progress Steps -->
    <div class="progress-container">
      <div class="progress-steps">
        <!-- Step 1: Personal Data -->
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
          <div class="step-circle">
            <ion-icon *ngIf="currentStep > 1" name="checkmark"></ion-icon>
            <ion-icon *ngIf="currentStep === 1" name="person"></ion-icon>
          </div>
          <span class="step-label">Datos Personales</span>
        </div>

        <div class="step-line" [class.completed]="currentStep > 1"></div>

        <!-- Step 2: Location -->
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
          <div class="step-circle">
            <ion-icon *ngIf="currentStep > 2" name="checkmark"></ion-icon>
            <ion-icon *ngIf="currentStep === 2" name="location"></ion-icon>
          </div>
          <span class="step-label">Ubicación</span>
        </div>

        <div class="step-line" [class.completed]="currentStep > 2"></div>

        <!-- Step 3: Profile Photo -->
        <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
          <div class="step-circle">
            <ion-icon *ngIf="currentStep > 3" name="checkmark"></ion-icon>
            <ion-icon *ngIf="currentStep === 3" name="camera"></ion-icon>
          </div>
          <span class="step-label">Foto de Perfil</span>
        </div>
      </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="showSuccessMessage" class="success-message">
      <ion-icon name="checkmark-circle" class="success-icon"></ion-icon>
      <h2>¡Registro Exitoso!</h2>
      <p>Tu solicitud de registro ha sido enviada. Te contactaremos pronto.</p>
    </div>

    <!-- Step Content -->
    <div class="step-content" *ngIf="!showSuccessMessage">
      <!-- Step 1: Personal Data -->
      <ion-card *ngIf="currentStep === 1" class="step-card">
        <ion-card-content>
          <h2 class="step-title">
            <ion-icon [name]="stepIcon"></ion-icon>
            {{ stepTitle }} *
          </h2>

          <form class="registration-form">
            <!-- First Name -->
            <ion-item class="form-item">
              <ion-label position="stacked">Nombre *</ion-label>
              <ion-input
                [(ngModel)]="personalData.firstName"
                name="firstName"
                placeholder="Ingresa tu nombre"
                required>
              </ion-input>
            </ion-item>

            <!-- Last Name -->
            <ion-item class="form-item">
              <ion-label position="stacked">Apellido *</ion-label>
              <ion-input
                [(ngModel)]="personalData.lastName"
                name="lastName"
                placeholder="Ingresa tu apellido"
                required>
              </ion-input>
            </ion-item>

            <!-- Email -->
            <ion-item class="form-item">
              <ion-label position="stacked">Email *</ion-label>
              <ion-input
                [(ngModel)]="personalData.email"
                name="email"
                type="email"
                placeholder="tu@email.com"
                required>
              </ion-input>
            </ion-item>

            <!-- Phone Fields -->
            <div class="phone-fields">
              <!-- Area Code -->
              <ion-item class="form-item phone-area-code">
                <ion-label position="stacked">Código de Área *</ion-label>
                <ion-input
                  [(ngModel)]="personalData.areaCode"
                  name="areaCode"
                  type="tel"
                  placeholder="011"
                  maxlength="4"
                  required>
                </ion-input>
              </ion-item>

              <!-- Phone Number -->
              <ion-item class="form-item phone-number">
                <ion-label position="stacked">Teléfono *</ion-label>
                <ion-input
                  [(ngModel)]="personalData.phone"
                  name="phone"
                  type="tel"
                  placeholder="1234-5678"
                  maxlength="10"
                  required>
                </ion-input>
              </ion-item>
            </div>

            <!-- Specialty -->
            <ion-item class="form-item">
              <ion-label position="stacked">Especialidad *</ion-label>
              <ion-select
                [(ngModel)]="personalData.specialty"
                name="specialty"
                placeholder="Selecciona tu especialidad"
                interface="popover">
                <ion-select-option *ngFor="let specialty of specialties" [value]="specialty">
                  {{ specialty }}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <!-- Description -->
            <ion-item class="form-item textarea-item">
              <ion-label position="stacked">Biografía *</ion-label>
              <ion-textarea
                [(ngModel)]="personalData.description"
                name="description"
                placeholder="Cuéntanos sobre tu experiencia y servicios..."
                rows="4"
                required>
              </ion-textarea>
            </ion-item>
          </form>
        </ion-card-content>
      </ion-card>

      <!-- Step 2: Location -->
      <ion-card *ngIf="currentStep === 2" class="step-card">
        <ion-card-content>
          <h2 class="step-title">
            <ion-icon [name]="stepIcon"></ion-icon>
            {{ stepTitle }} *
          </h2>

          <form class="registration-form">
            <!-- Address -->
            <ion-item class="form-item">
              <ion-label position="stacked">Dirección *</ion-label>
              <ion-input
                [(ngModel)]="locationData.address"
                name="address"
                placeholder="Av. Corrientes 1234"
                required>
              </ion-input>
            </ion-item>

            <!-- City -->
            <ion-item class="form-item">
              <ion-label position="stacked">Ciudad *</ion-label>
              <ion-input
                [(ngModel)]="locationData.city"
                name="city"
                placeholder="Buenos Aires"
                required>
              </ion-input>
            </ion-item>

            <!-- Province -->
            <ion-item class="form-item">
              <ion-label position="stacked">Provincia *</ion-label>
              <ion-select
                [(ngModel)]="locationData.province"
                name="province"
                placeholder="Selecciona provincia"
                interface="popover">
                <ion-select-option *ngFor="let province of provinces" [value]="province">
                  {{ province }}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <!-- Work Zone -->
            <ion-item class="form-item textarea-item">
              <ion-label position="stacked">Zona de Trabajo / Cobertura *</ion-label>
              <ion-textarea
                [(ngModel)]="locationData.workZone"
                name="workZone"
                placeholder="Ej: CABA y Gran Buenos Aires, Radio de 30km desde mi ubicación, etc."
                rows="3"
                required>
              </ion-textarea>
            </ion-item>

            <p class="help-text">Describe el área geográfica donde ofreces tus servicios</p>
          </form>
        </ion-card-content>
      </ion-card>

      <!-- Step 3: Profile Photo -->
      <ion-card *ngIf="currentStep === 3" class="step-card">
        <ion-card-content>
          <h2 class="step-title">
            <ion-icon [name]="stepIcon"></ion-icon>
            {{ stepTitle }} *
          </h2>

          <div class="photo-upload-section">
            <div class="photo-upload-area" (click)="fileInput.click()">
              <div class="upload-icon">
                <ion-icon name="camera"></ion-icon>
              </div>
              <p class="upload-text">Subir foto</p>
            </div>

            <input
              #fileInput
              type="file"
              accept="image/jpeg,image/jpg,image/png"
              (change)="onFileSelected($event)"
              style="display: none;">

            <p class="upload-instructions">
              Sube una foto profesional que te represente.<br>
              Formatos: JPG, PNG (máx. 5MB)
            </p>

            <!-- Preview -->
            <div *ngIf="profilePhoto.profilePhoto" class="photo-preview">
              <img [src]="getPhotoPreview()" alt="Preview">
              <p class="photo-name">{{ profilePhoto.profilePhoto.name }}</p>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons" *ngIf="!showSuccessMessage">
      <ion-button
        *ngIf="canGoPrevious"
        (click)="previousStep()"
        fill="outline"
        color="medium"
        class="nav-button">
        <ion-icon name="arrow-back" slot="start"></ion-icon>
        Anterior
      </ion-button>

      <ion-button
        *ngIf="!isLastStep"
        (click)="nextStep()"
        [disabled]="!canGoNext"
        fill="solid"
        color="primary"
        class="nav-button">
        Siguiente
        <ion-icon name="arrow-forward" slot="end"></ion-icon>
      </ion-button>

      <ion-button
        *ngIf="isLastStep"
        (click)="submitRegistration()"
        [disabled]="!canGoNext || isSubmitting"
        fill="solid"
        color="primary"
        class="nav-button">
        <ion-spinner *ngIf="isSubmitting" slot="start" name="crescent"></ion-spinner>
        {{ submitButtonText }}
      </ion-button>
    </div>
  </div>
</ion-content>
