<ion-content [fullscreen]="true">
  <!-- Header -->
  <ion-header [translucent]="true" *ngIf="professional">
    <ion-toolbar>
      <ion-button fill="clear" slot="start" (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
      <ion-title>{{ professional.name }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="professional-detail-page" *ngIf="professional">
    <!-- Main Content -->
    <div class="main-content">
    <!-- Left Column -->
    <div class="left-column">
      <!-- Profile Card -->
      <ion-card class="profile-card">
        <ion-card-content class="profile-content">
          <div class="profile-header">
            <div class="avatar-container">
              <app-profile-photo-thumbnail
                [photoUrl]="professional.avatar"
                [name]="professional.name"
                size="medium"
                [isEditable]="true"
                [showChangeButton]="true"
                (photoChange)="onPhotoChange($event)"
                (photoRemove)="onPhotoRemove()">
              </app-profile-photo-thumbnail>
            </div>
            <div class="profile-info">
              <div class="name-container">
                <h1 class="professional-name">{{ professional.name }}</h1>
                <ion-icon
                  *ngIf="professional.isVerified"
                  name="checkmark-circle"
                  class="verified-icon">
                </ion-icon>
              </div>
              <p class="profession">{{ professional.profession }}</p>
              <div class="rating-location">
                <div class="rating">
                  <ion-icon name="star" class="star-icon"></ion-icon>
                  <span class="rating-text">{{ professional.rating }} ({{ professional.reviews }} reseñas)</span>
                </div>
                <div class="location">
                  <ion-icon name="location" class="location-icon"></ion-icon>
                  <span class="location-text">{{ professional.location }}</span>
                </div>
              </div>
              <div class="status-tag" [style.background-color]="getStatusColor(professional.status)">
                {{ getStatusText(professional.status) }}
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- About Me Card -->
      <ion-card class="info-card">
        <ion-card-header>
          <ion-card-title class="card-title">Sobre mí</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="about-text">{{ professional.aboutMe }}</p>
        </ion-card-content>
      </ion-card>

      <!-- Skills Card -->
      <ion-card class="info-card">
        <ion-card-header>
          <ion-card-title class="card-title">Habilidades</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="skills-container">
            <ion-chip *ngFor="let skill of professional.skills" class="skill-tag">{{ skill }}</ion-chip>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Work Zone Card -->
      <ion-card class="info-card">
        <ion-card-header>
          <ion-card-title class="card-title">Zona de Trabajo</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="work-zone-description">Áreas de cobertura donde este profesional ofrece sus servicios:</p>
          <div class="work-zones-container">
            <ion-chip *ngFor="let zone of professional.workZones" class="work-zone-tag">
              <ion-icon name="location" slot="start"></ion-icon>
              {{ zone }}
            </ion-chip>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Experience Section -->
      <ion-card class="experience-card">
        <ion-card-header>
          <ion-card-title class="section-title">
            <ion-icon name="briefcase" class="section-icon"></ion-icon>
            Experiencia
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="experience-content">
            <div class="experience-years">
              <ion-icon name="briefcase" class="briefcase-icon"></ion-icon>
              <span class="years-text">{{ professional.experience?.years || 5 }}+ años de experiencia</span>
            </div>
            <p class="experience-description">
              {{ professional.experience?.description || 'Especializado en desarrollo mobile con un historial comprobado de proyectos exitosos y clientes satisfechos.' }}
            </p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Reviews Section -->
      <ion-card class="reviews-card">
        <ion-card-header>
          <div class="reviews-header">
            <ion-card-title class="section-title">
              <ion-icon name="star" class="section-icon"></ion-icon>
              Valoraciones y Reseñas
            </ion-card-title>
            <ion-button
              class="leave-review-button"
              (click)="onLeaveReview()"
              fill="outline"
              size="small">
              Dejar valoración
            </ion-button>
          </div>
        </ion-card-header>
        <ion-card-content>
          <div class="reviews-content" *ngIf="professional.reviewData?.hasReviews; else noReviews">
            <div class="rating-display">
              <div class="rating-number">{{ professional.reviewData?.averageRating || professional.rating }}</div>
              <div class="stars-container">
                <ion-icon
                  *ngFor="let star of [1,2,3,4,5]"
                  name="star"
                  class="star-icon"
                  [class.filled]="star <= Math.floor(professional.reviewData?.averageRating || professional.rating)"
                  [class.half-filled]="star === Math.ceil(professional.reviewData?.averageRating || professional.rating) && (professional.reviewData?.averageRating || professional.rating) % 1 !== 0">
                </ion-icon>
              </div>
              <div class="reviews-count">({{ professional.reviewData?.totalReviews || professional.reviews }} reseñas)</div>
            </div>
          </div>
          <ng-template #noReviews>
            <div class="no-reviews">
              <ion-icon name="star-outline" class="empty-star-icon"></ion-icon>
              <p class="no-reviews-text">Aún no hay valoraciones. Sé el primero en dejar una reseña.</p>
            </div>
          </ng-template>
        </ion-card-content>
      </ion-card>

      <!-- Q&A Section -->
      <ion-card class="qa-card">
        <ion-card-header>
          <div class="qa-header">
            <ion-card-title class="section-title">
              <ion-icon name="chatbubble-outline" class="section-icon"></ion-icon>
              Preguntas y Respuestas
            </ion-card-title>
            <ion-button
              class="ask-question-button"
              (click)="onAskQuestion()"
              fill="outline"
              size="small">
              Hacer una pregunta
            </ion-button>
          </div>
        </ion-card-header>
        <ion-card-content>
          <div class="qa-content" *ngIf="professional.qa?.hasQuestions; else noQuestions">
            <p class="questions-count">{{ professional.qa?.totalQuestions || 0 }} preguntas respondidas</p>
            <!-- Aquí se mostrarían las preguntas y respuestas -->
          </div>
          <ng-template #noQuestions>
            <div class="no-questions">
              <ion-icon name="chatbubble-outline" class="empty-chat-icon"></ion-icon>
              <p class="no-questions-text">Aún no hay preguntas. Sé el primero en preguntar.</p>
            </div>
          </ng-template>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- Price & Contact Card -->
      <ion-card class="contact-card">
        <ion-card-content class="contact-content">
          <div class="price-section">
            <div class="price-amount">${{ professional.pricePerHour }}</div>
            <div class="price-unit">por hora</div>
          </div>
          <ion-button class="contact-button" (click)="contactProfessional()" fill="solid" color="primary" size="large">
            <ion-icon name="mail" slot="start"></ion-icon>
            Contactar
          </ion-button>
        </ion-card-content>
      </ion-card>

      <!-- Statistics Card -->
      <ion-card class="stats-card">
        <ion-card-header>
          <ion-card-title class="stats-title">Estadísticas</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">Proyectos completados</span>
              <span class="stat-value">{{ professional.completedProjects }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Tasa de respuesta</span>
              <span class="stat-value">{{ professional.responseRate }}%</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Tiempo de respuesta</span>
              <span class="stat-value">{{ professional.responseTime }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Verified Profile Card -->
      <ion-card class="verified-card">
        <ion-card-content class="verified-content">
          <div class="verified-header">
            <ion-icon name="checkmark-circle" class="verified-icon"></ion-icon>
            <h3 class="verified-title">Perfil Verificado</h3>
          </div>
          <p class="verified-description">
            Este profesional ha completado el proceso de verificación y ha sido validado por nuestro equipo.
          </p>
        </ion-card-content>
      </ion-card>
    </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="!professional">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando perfil...</p>
  </div>
</ion-content>

<!-- Contact Modal -->
<app-contact-modal
  [professional]="professional"
  [isOpen]="isContactModalOpen"
  (closeModal)="onCloseContactModal()">
</app-contact-modal>

<!-- Review Modal -->
<app-review-modal
  [professional]="professional"
  [isOpen]="isReviewModalOpen"
  (closeModal)="onCloseReviewModal()"
  (submitReview)="onSubmitReview($event)">
</app-review-modal>

<!-- Question Modal -->
<app-question-modal
  [professional]="professional"
  [isOpen]="isQuestionModalOpen"
  (closeModal)="onCloseQuestionModal()"
  (submitQuestion)="onSubmitQuestion($event)">
</app-question-modal>
