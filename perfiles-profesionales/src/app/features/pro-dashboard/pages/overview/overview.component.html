<ion-content [fullscreen]="true">
<div class="overview">
  <h2 class="title">Resumen</h2>

  <!-- Card de usuario actual -->
  <ion-card class="welcome-card" style="margin-bottom: 1rem;">
    <ion-card-content>
      <ion-grid>
        <ion-row class="ion-align-items-center">
          <ion-col size="6" size-md="8">
            <div style="display:flex; flex-direction:column; gap:.25rem;">
              <div class="welcome-title" style="font-weight:700;">Bienvenido {{ fullName }}!</div>
              <div>Usuario: {{ currentUser?.username }}</div>
              <div>Email: {{ currentUser?.email }}</div>
            </div>
          </ion-col>
          <ion-col size="6" size-md="4" class="ion-text-right right-col">
            <img *ngIf="profilePhotoUrl; else initials" [src]="profilePhotoUrl" alt="Foto de perfil" class="avatar" />
            <ng-template #initials>
              <div class="initials">
                {{ (currentUser?.first_name || 'U').charAt(0) }}{{ (currentUser?.last_name || 'S').charAt(0) }}
              </div>
            </ng-template>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <ion-grid class="stats-grid">
    <ion-row>
      <ion-col size="12" size-md="6" size-lg="3">
        <ion-card class="stat-card center">
          <ion-card-content>
            <div class="stat-row">
              <ion-icon name="star" class="stat-icon rating"></ion-icon>
              <div class="stat-data">
                <div class="stat-value">{{ stats.averageRating | number:'1.1-1' }}</div>
                <div class="stat-label">Promedio</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6" size-md="6" size-lg="3">
        <ion-card class="stat-card center">
          <ion-card-content>
            <div class="stat-row">
              <ion-icon name="trending-up" class="stat-icon reviews"></ion-icon>
              <div class="stat-data">
                <div class="stat-value">{{ stats.totalReviews }}</div>
                <div class="stat-label">Valoraciones recibidas</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6" size-md="6" size-lg="3">
        <ion-card class="stat-card center">
          <ion-card-content>
            <div class="stat-row">
              <ion-icon name="chatbubbles" class="stat-icon questions"></ion-icon>
              <div class="stat-data">
                <div class="stat-value">{{ stats.pendingQuestions }}</div>
                <div class="stat-label">Preguntas pendientes</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <div class="actions">
    <ion-button class="zone-button" fill="solid" routerLink="/panel/zonas">
      <ion-icon name="map" slot="start"></ion-icon>
      Zona de trabajo
    </ion-button>
  </div>

  <ion-grid class="lists-grid">
    <ion-row>
      <ion-col size="12" size-lg="6">
        <ion-card>
          <ion-card-content>
            <div class="card-header">
              <h3>Últimas 5 Valoraciones</h3>
              <ion-button size="small" fill="clear" routerLink="/panel/valoraciones">Ver todo</ion-button>
            </div>
            <ion-list>
              <ion-item *ngIf="loadingReviews">
                <ion-label>
                  <div style="text-align: center; padding: 1rem;">
                    <ion-spinner></ion-spinner>
                  </div>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="!loadingReviews && lastReviews.length === 0">
                <ion-label>
                  <div class="item-sub">No hay valoraciones disponibles</div>
                </ion-label>
              </ion-item>
              <ion-item *ngFor="let r of lastReviews">
                <ion-label>
                  <div class="item-title">
                    {{ getUserDisplayName(r) }}
                    <span class="stars">
                      <ion-icon *ngFor="let i of [0,1,2,3,4]" [name]="i < r.value ? 'star' : 'star-outline'"></ion-icon>
                    </span>
                    <span class="rating-number">({{ r.value }}/5)</span>
                  </div>
                  <div class="item-sub" *ngIf="hasComment(r)">{{ r.comment }}</div>
                  <div class="item-sub" *ngIf="!hasComment(r)"><em>Sin comentario</em></div>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" size-lg="6">
        <ion-card>
          <ion-card-content>
            <div class="card-header">
              <h3>Últimas 5 Preguntas</h3>
              <ion-button size="small" fill="clear" routerLink="/panel/preguntas">Ver todo</ion-button>
            </div>
            <ion-list>
              <ion-item *ngIf="loadingQuestions">
                <ion-label>
                  <div style="text-align: center; padding: 1rem;">
                    <ion-spinner></ion-spinner>
                  </div>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="!loadingQuestions && lastQuestions.length === 0">
                <ion-label>
                  <div class="item-sub">No hay preguntas disponibles</div>
                </ion-label>
              </ion-item>
              <ion-item *ngFor="let q of lastQuestions">
                <ion-label>
                  <div class="item-title">{{ getQuestionDisplayName(q) }}</div>
                  <div class="item-sub">{{ q.question }}</div>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>
</ion-content>


