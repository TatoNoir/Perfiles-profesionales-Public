<ion-content [fullscreen]="true" class="qa-content">
<div class="qa-page">
  <h2 class="title">Preguntas</h2>

  <ion-card *ngIf="loadingQuestions">
    <ion-card-content>
      <div style="text-align: center; padding: 2rem;">
        <ion-spinner></ion-spinner>
        <p>Cargando preguntas...</p>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="!loadingQuestions && questions.length === 0">
    <ion-card-content>
      <div style="text-align: center; padding: 2rem;">
        <p>No hay preguntas disponibles</p>
      </div>
    </ion-card-content>
  </ion-card>


  <!-- Preguntas Sin Responder -->
  <ion-card *ngIf="!loadingQuestions && unansweredQuestions.length > 0">
    <ion-card-content>
      <h3 class="section-title">
        <ion-icon name="help-circle-outline" class="section-icon"></ion-icon>
        Preguntas sin responder
      </h3>
      <ion-list class="qa-list">
        <ion-item lines="full" *ngFor="let q of unansweredQuestions" class="qa-item">
          <div class="single-column" style="display:flex; flex-direction:column; gap:.5rem; width:100%;">
            <div class="question-header">
              <strong>{{ getUserDisplayName(q) }}</strong>
              <span class="date">{{ formatDate(q.created_at) | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="question">
              <strong>Pregunta:</strong>
              <span> {{ q.question }}</span>
            </div>
            <div class="answer empty">
              <strong>Respuesta:</strong>
              <span>
                {{ isPending(q) ? 'Respuesta pendiente de aprobación.' : '—' }}
              </span>
            </div>
            <ion-button size="small" fill="clear" color="primary" (click)="onReply(q)" style="align-self:flex-start; margin-top:.25rem;">
              Responder
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Preguntas Respondidas -->
  <ion-card *ngIf="!loadingQuestions && answeredQuestions.length > 0">
    <ion-card-content>
      <h3 class="section-title">
        <ion-icon name="checkmark-circle" class="section-icon"></ion-icon>
        Preguntas respondidas
      </h3>
      <ion-list class="qa-list">
        <ion-item lines="full" *ngFor="let q of answeredQuestions" class="qa-item">
          <div class="single-column" style="display:flex; flex-direction:column; gap:.5rem; width:100%;">
            <div class="question-header">
              <strong>{{ getUserDisplayName(q) }}</strong>
              <span class="date">{{ formatDate(q.created_at) | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="question">
              <strong>Pregunta:</strong>
              <span> {{ q.question }}</span>
            </div>
            <div class="answer">
              <strong>Respuesta:</strong>
              <span>{{ q.answer }}</span>
            </div>
            <ion-button size="small" fill="clear" (click)="onReply(q)" style="align-self:flex-start; margin-top:.25rem;">
              Modificar respuesta
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-modal [isOpen]="isReplyOpen" (didDismiss)="closeReply()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ selectedQuestion?.answer ? 'Modificar respuesta' : 'Responder pregunta' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button fill="clear" (click)="closeReply()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div *ngIf="selectedQuestion" style="margin-bottom: 1rem;">
          <p><strong>Pregunta:</strong></p>
          <p>{{ selectedQuestion.question }}</p>
        </div>
        <ion-textarea
          label="Respuesta"
          labelPlacement="stacked"
          placeholder="Escribe tu respuesta..."
          [(ngModel)]="replyText"
          [disabled]="savingAnswer"
          rows="6">
        </ion-textarea>
        <div style="margin-top: .75rem; display:flex; justify-content:flex-end; gap:.5rem;">
          <ion-button
            fill="outline"
            color="medium"
            (click)="closeReply()"
            [disabled]="savingAnswer">
            Cancelar
          </ion-button>
          <ion-button
            color="primary"
            (click)="submitReply()"
            [disabled]="savingAnswer || !replyText.trim()">
            <ion-spinner *ngIf="savingAnswer" name="crescent"></ion-spinner>
            <span *ngIf="!savingAnswer">{{ selectedQuestion?.answer ? 'Actualizar' : 'Enviar' }}</span>
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-toast
    [isOpen]="showToast"
    [message]="toastMessage"
    [color]="toastColor"
    [duration]="3000"
    (didDismiss)="showToast = false">
  </ion-toast>
</div>
</ion-content>

