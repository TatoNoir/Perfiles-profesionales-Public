<ion-card class="forgot-card">
  <ion-card-content>
    <!-- Paso 1: Solicitar token -->
    <div *ngIf="!tokenReceived">
      <h2>Recuperar contraseña</h2>
      <p>Ingresá tu email y te enviaremos un token de recuperación.</p>

      <ion-item class="form-item">
        <ion-label position="stacked">Email</ion-label>
        <ion-input
          type="email"
          [(ngModel)]="email"
          [disabled]="requestingToken"
          placeholder="tu@email.com">
        </ion-input>
      </ion-item>

      <ion-button
        expand="block"
        (click)="onRequestToken()"
        [disabled]="requestingToken || !email">
        <ng-container *ngIf="!requestingToken; else loadingToken">
          Enviar
        </ng-container>
        <ng-template #loadingToken>
          <ion-spinner name="crescent" style="margin-right: 8px"></ion-spinner>
          Enviando...
        </ng-template>
      </ion-button>
    </div>

    <!-- Paso 2: Resetear contraseña -->
    <div *ngIf="tokenReceived && !passwordReset">
      <h2>Nueva contraseña</h2>
      <p>Ingresá tu nueva contraseña. Debe tener al menos 6 caracteres.</p>

      <ion-item class="form-item">
        <ion-label position="stacked">Contraseña nueva</ion-label>
        <ion-input
          type="password"
          [(ngModel)]="password"
          [disabled]="resettingPassword"
          placeholder="Mínimo 6 caracteres">
        </ion-input>
      </ion-item>

      <ion-item class="form-item">
        <ion-label position="stacked">Repetir contraseña</ion-label>
        <ion-input
          type="password"
          [(ngModel)]="passwordConfirmation"
          [disabled]="resettingPassword"
          placeholder="Confirma tu contraseña">
        </ion-input>
      </ion-item>

      <ion-button
        expand="block"
        (click)="onResetPassword()"
        [disabled]="resettingPassword || !password || !passwordConfirmation">
        <ng-container *ngIf="!resettingPassword; else loadingReset">
          Cambiar contraseña
        </ng-container>
        <ng-template #loadingReset>
          <ion-spinner name="crescent" style="margin-right: 8px"></ion-spinner>
          Actualizando...
        </ng-template>
      </ion-button>
    </div>

    <!-- Mensaje de éxito -->
    <div *ngIf="passwordReset" class="success-message">
      <h2>¡Contraseña actualizada!</h2>
      <p>Tu contraseña ha sido actualizada correctamente. Serás redirigido al login...</p>
    </div>

    <div class="links">
      <a routerLink="/login">Volver a Ingresar</a>
    </div>
  </ion-card-content>
</ion-card>

<!-- Toast para mensajes -->
<ion-toast
  [isOpen]="showToast"
  [message]="toastMessage"
  [color]="toastColor"
  [duration]="4000"
  (didDismiss)="showToast = false">
</ion-toast>


